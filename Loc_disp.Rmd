---
title: "Parametros de localizacion y dispercion"
author: "Nicolás Molano Gonzalez"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  bookdown::html_document2: default
bibliography: references.bib  
---

```{r echo=F, message = FALSE, warning =F}
library(pacman)
p_load(tidyverse)
p_load(kableExtra)
p_load(knitr)
p_load(latex2exp)   
p_load(ggrepel)
p_load(magick)
set.seed(150)
```

# Introduccion

En capitulos anteriores, hemos estudiado el calculo de probabilidades para eventos que, en la practica, son codificados como variables categoricas. Ahora ha llegado el momento de estudiar como funciona la medida de probabilidad para el caso en que la variable es cuantitativa. Empezaremos nuestro estudio con un ejemplo graphico. En la figura \@ref(fig:fdmw) se presenta una informacion relacionada con el peso de hombres y mujeres.

```{r fdmw, echo=FALSE, results = 'asis',fig.width=8, fig.height=4, fig.cap="Distribucion de peso para hombres y mujeres"}
mf<-55
mm<-70
sdf<-8
sdm<-12
weight_lim<-c(30, 110)
p1<-ggplot(data = data.frame(weight = weight_lim), aes(weight)) +
  stat_function(fun = dnorm, n = 101, args = list(mean = mm, sd = sdm),color=1) +
  stat_function(fun = dnorm, n = 101, args = list(mean = mf, sd = sdf),color=2) +
  ylab("f(weight)") + scale_x_continuous(breaks=seq(weight_lim[1],weight_lim[2], by=5)) + 
  annotate("text", x = c(65,80), y = c(.04,.03), 
           label = c("Female","Male") , size=4 , 
           color=c("red","black"))+
  theme_bw()
p1
```

Cuando se le pregunta a los estudiantes sobre la interpretacion de este grafico, la mayoria de ellos genera interpretaciones acertadas de este. Veamos algunas de estas interpretaciones acertadas:

* El peso de las mujeres esta al rededor de los $55kg$ mientras que el de los hombres esta al rededor de los $70kg$
* Las mujeres sulen pesar menos que los hombres
* El rango de pesos de los hombres es mas ampliio que el de las mujeres.

Ahora veamos una de las interpretaciones incorrectas mas comunes para este mismo grafico:

* Hay mas mujeres que hombres

Lo cierto es que la mayoria de estudiantes conocen de alguna manera la interpretacion correcta de este grafico, ya sea por intuicion o por formacion previa. Lo importante es que en este capitulo aclararemos estas ideas y las formalizaremos en terminos probabilisticos.

# Funcion de densidad

Las curvas presentadas en la figura \@ref(fig:fdmw) reciben el nombre tecnico de funcion de densidad. Son funciones matematicas comunes las cuales se representan en un plano cartesiano. Para repazar estos conceptos sugerimos revizar los siguientes recursos:

* https://www.profesorenlinea.cl/matematica/Funciones_matematicas.html
* https://www.ck12.org/book/ck-12-conceptos-de-%c3%a1lgebra-i-en-espa%c3%b1ol/section/1.12/
* https://www.ck12.org/book/ck-12-conceptos-de-%c3%81lgebra-nivel-b%c3%a1sico-en-espa%c3%b1ol/section/1.13/

Es fundamental recordar los conceptos basicos al rededor de la representacion de funciones en el plano cartesiano para poder comprender plenamente los conceptos aqui tratados. 

De esta manera, las curvas presentadas en la \@ref(fig:fdmw) son simplemente funciones matematicas, por ejemplo para la funcion de densidad de las mujeres (que de ahora en adelante denominaremos por $f_F(x)$), el valor de la funcion para el peso de $55kg$ es de $0.05$, es decir: $f_F(55)=0.05$. De manera similar, para la funcion de densidad de los hombres (que de ahora en adelante denominaremos por $f_M(x)$), el valor de la funcion para el peso de $55kg$ es de $0.015$, es decir: $f_M(55)=0.015$.

La pregunta fundamental que surge a continuacion es "¿que significa el valor $f(x)$?" en donde $f$ es una funcion de densidad? Dicho tambien de otro modo, en una primera aproximacion de los estudiantes al grafico de la figura \@ref(fig:fdmw), "¿Que significa el eje $y$ en la figura \@ref(fig:fdmw)?". Esta pregunta se responde de manera mucho mas facil cuando se estudian funciones de densidad para variables discretas.

## Funciones de densidad para variables discretas

Empezaremos esta discucion con el siguiente ejemplo. Considerese la variable "Numero de hijos en un matrimonio". En la figura \@ref(fig:fdpois) se presenta la funcion de densidad para esta variable.

```{r fdpois, echo=FALSE, results = 'asis',fig.width=7, fig.height=4, fig.cap="Funcion de densidad para la variable numero de hijos"}
dtf_pois<-data.frame(x=factor(0:11),y=dpois(0:11,3))
dtf_pois%>%ggplot(aes(x=x,y=y))+geom_point()+
  ylab("f(x)")+ theme_bw()+
  theme(axis.title.y = element_text(angle=0))+
  annotate("text", x = dtf_pois$x, y = dtf_pois$y+.01, 
           label = paste0("(",dtf_pois$x,", ",round(dtf_pois$y,3),")"),parse=F , size=2.5 , fontface="bold")
  
```
Para facilidad del lector, en la grafica aparecen las coordenadas $(x,f(x))$, en donde $x$ es el numero de hijos y $f(x)$ es el valor de la funcion de densidad respectiva. En el caso en el que la variable es discreta, la funcion de densidad resulta coincidri con la probabilidad. Es decir que la probabilidad de que el matrimonio no tenga hijos es de `r round(dtf_pois$y[1],3)`. El lector puede verificar que en efecto los valores de $f(x)$ son probabilidades, ya que al sumar todos los 12 valores el resultado es uno. Es decir $\sum_{i=0}^{11} f(x_i)=1$ (Lo invitamos a repasar el significado del simbolo $\sum$ visitando el siguiente recurso: https://www.profesorenlinea.cl/matematica/Sumatoria.html)

Es decir que en el caso en que la variable es discreta se tiene que

\begin{equation}
Si\; x\; es \; una \; variable \; discreta\; entonces \; f(x)=P(X=x) (\#eq:discrfd)
\end{equation}

Donde $P(X=x)$ se interpreta como "la probabilidad de que la variable $X$ tome el valor $x$". Mas adelante profundizaremos en la notacion y diferencias entre $X$ y $x$.

Para este caso en el que la variable es discreta usted puede usar las reglas vistas en capitulos anteriores para hacer calculos de probabilidad. Por ejemplo, preguntemonos por lo siguiente:

* ¿Cual es la probabilidad de que el numero de hijos sea menor a 4?

Esto en terminos de formulas equivale a $P(X<4)$. Para calcular esta probabilidad, simplemente sumamos las probabilidades de los numeros que cumplen la condicion $x<4$, es decir 
$$P(X<4)=\sum_{i=0}^{3}P(X=x_i)=\sum_{i=0}^{3}f(x_i)=$$
$$0.05+0.149+0.224+0.224=0.647$$

Puede usted intuir de manera rapida como se calculara $P(X \geq 4)$? Haciendo uso de la regla del complemento, se tiene que $P(X \geq 4)=1-P(X<4)=1-0.647=0.353$.

## Funciones de densidad para variables continuas

En el caso en que las variables son continuas, ya no se cumple que la equacion \@ref(eq:discrfd). Esto es debido a la naturaleza extraña de los numeros reales. Para cualquier numero real $x$ sucede que
\begin{equation}
Si\; x\; es \; un \; numero \; real \; entonces \; P(X=x)=0 (\#eq:realpo)
\end{equation}

La ecuacion \@ref(eq:realpo) parece contraintuitiva, sin embargo tiene sentido. Pensemos en la variable peso (medida en Kg). Cuando yo mido mi peso en una vascula obtenumos un valor como por ejemplo $78.3$. Es laro que la variable peso es una variable continua, y al serlo sus valores son numeros reales, numeros con una expancion en desimales infinita. Pero la vascula reporta solo un desimal, esto tiene que ver con la exactitud y presecion, conceptos discutidos anteriormente. el reporte de la vascula no es relamente un numero sino un rango:

$$78.30000...., 78.39999....$$
Es decir que la vascula esta reportando que mi peso es un numero real que se encuentra en el rango $78.30000...., 78.39999....$. De hecho el verdadero valor de mi peso es un numero real con una expancion decimal infinita que nunca llegaremos a conocer, y es debido a esa expancion en desimales infinita que la ecuacion \@ref(eq:realpo) se cumple. Cuando la variable es continua, no tiene sentido pensar en la probabilidad de que la variable tome un valor (un nunmero real) arbitrario, tiene mas sentido preguntarnos por la probabilidad de que la variable tome valores en un rango. Es decir que en ves de preguntarnos por la probabilidad de que el valor de peso sea igual a $78.3$ (es decir $P(X=78.3)$), es mas apropiado pensar en $P(78.30000....<X< 78.39999....)$. La pregunta que surge a continuacion es ¿como se calculan estas probabilidades?

### Probabilidades para variables continuas

Los conjuntos a los cuales medimos probabilidades en variables continuas son segmentos de recta definidos como $x\leq 5$, $x< 4$, $x \ge 10$, $x>15$, $2<x <10$, $-3\leq x <15$, etc. Lo invitamos a repasar los conceptos asociados a los segmentos de recta en los numeros reales visitando el siguiente link: https://www.matesfacil.com/ESO/numeros/intervalos/concepto/concepto-intervalo-abierto-cerrado-numeros-reales-extremos-test-online.html

Las probabilidades en este contexto resultan ser areas bajo la funcion dedensidad, delimitados por los segmentos de recta a los cuales se les desea calcular la probabilidad. Por ejemplo, calcularemos la probabilidad de observar pesos entre 50 y 70 en ambos sexos:

```{r fdmwP1,echo=FALSE, results = 'asis',fig.width=8, fig.height=6, fig.cap="Probabilidad de peso entre 50 y 70"}
xrange<-c(50,70)
p11<-p1+geom_segment(aes(x=xrange,xend=xrange,y=0,yend=dnorm(c(50,70),mf,sdf)),linetype=2)+
  stat_function(fun = dnorm, args = list(mean = mf,sd=sdf),
                xlim =xrange,
                geom = "area",fill="red",alpha=0.5)+
  annotate("segment", x = c(55), xend = c(40), 
           y = c(0.03), yend = c(.04), colour = "red", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("text", x = 38, y = .044, 
           label = "P(list(50 <Weight)<70)==0.746",parse=T , size=3 , fontface="bold")+
  ggtitle("A) Probabilidad de peso entre 50 y 70 para F")
p12<-p1+geom_segment(aes(x=xrange,xend=xrange,y=0,yend=dnorm(xrange,mm,sdm)),linetype=2)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm),
                xlim =xrange,
                geom = "area",fill="grey",alpha=0.5)+
  annotate("segment", x = c(62.5), xend = c(75), 
           y = c(0.015), yend = c(.04), colour = "black", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("text", x = 80, y = .044, 
           label = "P(list(50 <Weight)<70)==0.452",parse=T , size=3 , fontface="bold")+
  ggtitle("B) Probabilidad de peso entre 50 y 70 para M")
gridExtra::grid.arrange(grobs =list(p11,p12),nrow=2,ncol=1)
```

Las areas bajo la curva se calculan mediante la operacion integracion (ver <http://hyperphysics.phy-astr.gsu.edu/hbasees/integ.html>).

Sea $f_F(x)$ la funcion de densidad del peso de las mujeres y $f_M(x)$ la funcion de densidad del peso de los hombres. Estas funciones tienen las siguientes formulas:

$$f_F(x)=\frac{1}{\sqrt{2\pi8^2}}exp\left(\frac{-(x-55)^2}{8^2}\right)$$
$$f_M(x)=\frac{1}{\sqrt{2\pi12^2}}exp\left(\frac{-(x-70)^2}{12^2}\right)$$
Estas son solo funciones matematicas como por ejemplo $f(x)=10+15x$ o$f(x)=x^2$.

Ahora, definimos las variables aleatorias $W_F$ y $W_M$ como los pesos de hombres y mujeres respectivamente. Entonces 

\begin{equation}
P(50<W_F<70)=\int_{50}^{70}f_F(x)dx=0.746 (\#eq:pwf1)
\end{equation}

\begin{equation}
P(50<W_M<70)=\int_{50}^{70}f_M(x)dx=0.452 (\#eq:pwm1)
\end{equation}

Donde $P(50<W_F<70)$ y $P(50<W_M<70)$ denotan simplmente la probabilidad de observar pesos entre 50 y 70 para mujeres y hombres respectivamente. Estas probabilidades corresponden a las areas mostradas en la figura \@ref(fig:fdmwP1). Notese como estas areas tienen su notacion respectiva en las formulas \@ref(eq:pwf1) y \@ref(eq:pwm1).

Otro tipo de calculos son por ejemplo $P(W_F < 45)$ o $P(W_M>90)$

```{r fdmwP2,echo=FALSE, results = 'asis',fig.width=8, fig.height=4, fig.cap="Probabilidad de peso \"menor que\" y \"mayor que\""}
xrange<-c(45,90)
p11<-p1+geom_segment(aes(x=xrange,xend=xrange,y=c(0,0),yend=c(dnorm(xrange[1],mf,sdf),dnorm(xrange[2],mm,sdm))),linetype=2,col=2:1)+
  stat_function(fun = dnorm, args = list(mean = mf,sd=sdf),
                xlim = c(weight_lim[1],xrange[1]),
                geom = "area",fill="red",alpha=0.5)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm),
                xlim = c(xrange[2],weight_lim[2]),
                geom = "area",fill="grey",alpha=0.5)+
  annotate("segment", x = c(40), xend = c(35), 
           y = c(0.005), yend = c(.018), colour = "red", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("segment", x = c(92.5), xend = c(95), 
           y = c(0.0025), yend = c(.0125), colour = "black", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("text", x = 35, y = .02, 
           label = "P(W[F]<45)==0.11",parse=T , size=3 , fontface="bold")+
  annotate("text", x = 94, y = .015, 
           label = "P(W[M]>90)==0.048",parse=T , size=3 , fontface="bold")
p11
```

Lo anterior se escribe en símbolos de integración como

\begin{equation}
P(W_F<45)=\int_{-\infty}^{45}f_F(x)dx=0.11 (\#eq:pwf2)
\end{equation}

\begin{equation}
P(W_M>90)=\int_{90}^{\infty}f_M(x)dx=0.048 (\#eq:pwm2)
\end{equation}

$P(W_F<45)=0.11$ se interpreta de la siguiente forma: "11% de las mujeres tienen pesos menores a 45kg" o "la probabilidad de observar mujeres con pesos menores a 45kg es de 11%".

De forma similar, $P(W_M>90)=0.048$, significa que 4.8% de los hombres tienen pesos mayores a 90Kg o que la probabilidad de observar hombres con pesos mayores a 90kg es de 4.8%.

Notese como estas areas tienen su notacion respectiva en las formulas \@ref(eq:pwf2) y \@ref(eq:pwm2).

$$P(50<W_M<70)=0.452$$ Significaría que 45.2% de los hombres tiene pesos entre 50 y 70 o que la probabilidad de observar hombres con pesos entre 50 y 70 es de 45.2%

En base a esta información es claro que $P(W_F >45)=1-P(W_F<45)$  y de manera similar $P(W_M<90)=1-P(W_M>90)$. Esto se debe al aplicar la regla del complemento, vista anteriormente.

```{r fdmwP3,echo=FALSE, results = 'asis',fig.width=8, fig.height=6, fig.cap="Probabilidad del complemento"}
p11<-p1+geom_segment(aes(x=xrange[1],xend=xrange[1],y=c(0),yend=c(dnorm(xrange[1],mf,sdf))),linetype=2,col=2)+
  stat_function(fun = dnorm, args = list(mean = mf,sd=sdf),
                xlim = c(weight_lim[1],xrange[1]),
                geom = "area",fill="red",alpha=0.5)+
  stat_function(fun = dnorm, args = list(mean = mf,sd=sdf),
                xlim = c(xrange[1],weight_lim[2]),
                geom = "area",fill="#CC3366",alpha=0.5)+
  annotate("segment", x = c(40), xend = c(35), 
           y = c(0.005), yend = c(.018), colour = "red", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("segment", x = c(55), xend = c(80), 
           y = c(.035), yend = c(.04), colour = "#CC3366", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("text", x = 35, y = .02, 
           label = "P(W[F]<45)==0.11",parse=T , size=3 , fontface="bold")+
  annotate("text", x = 94, y = .04, 
           label = "list(P(W[F]>45)==1-0.11)==0.89",parse=T , size=3 , fontface="bold")+
  ggtitle(expression(list(P(W[F]>45)==1-0.11)==0.89))
p12<-p1+geom_segment(aes(x=xrange[2],xend=xrange[2],y=c(0),yend=c(dnorm(xrange[2],mm,sdm))),linetype=2,col=1)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm),
                xlim = c(weight_lim[2],xrange[2]),
                geom = "area",fill="grey",alpha=0.5)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm),
                xlim = c(weight_lim[1],xrange[2]),
                geom = "area",fill="#444444",alpha=0.5)+
  annotate("segment", x = c(92.5), xend = c(95), 
           y = c(0.0025), yend = c(.0125), colour = "black", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("segment", x = c(70), xend = c(75), 
           y = c(.025), yend = c(.04), colour = "#444444", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("text", x = 94, y = .015, 
           label = "P(W[M]>90)==0.048",parse=T , size=3 , fontface="bold")+
  annotate("text", x = 83, y = .043, 
           label = "list(P(W[M]<90)==1-0.048)==0.952",parse=T , size=3 , fontface="bold")+
  ggtitle(expression(list(P(W[M]>90)==1-0.048)==0.952))
gridExtra::grid.arrange(grobs =list(p11,p12),nrow=2,ncol=1)
```

finalmente, cabe preguntarse por lo siguiente: ¿Cuanto mide el area total bajo la funcion de densidad? Esta area tiene su notacion respectiva en terminos de integrales:

$$P(-\infty<W_M<\infty)=\int_{-\infty}^{\infty}f_M(x)dx$$
Es decir la integral de menos infinito a infinito de la funcion de densidad $f_M(x)$. Como es de esperarse esta area (o probabilidad) mide $1$, de manera homologa al calso del axioma 2 de proabibilidad visto anteriormente. La probabilidad de observar cualquier valor posible es $1$.

Teneindo en cuenta esto, se da uno cuenta que el area bajo las funciones de densidad $f_F(x)$  y $f_M(x)$ es la misma y es de $1$. Por esta razon, se equivocan algunos estudiantes al pensar que la funcion de densidad $f_F(x)$ tiene mas area que $f_M(x)$  infiriendo que hay mas mujeres que hombres. Al tener ambas c¡funciones de densidad la misma area, el grafico que hemos venido discutiendo no nos puede dar informacion acerca del numero de hombres y mujeres.

Estas notaciones de integrales para representar el area bajo la curva son algo complicadas, las presentamos aca para dar un punto de referencia tecnico, sin embargo, lo importante es lo siguiente:

* Para las variables continuas, los conjuntos a los cuales se les mediran probabilidades son segmentos de recta.
* Las probabilidades se miden como areas bajo la funcion de densidad delimitadas por los segmentos de recta.
* Las areas bajo la funcion de densidad se miden a travez de la operacion de integracion.

# Variable aleatoria

En las discuciones anteriores se ha mencionado el termino variable aleatoria, ¿Que es exactamente? La respuesta es sencilla. La definicion tecnica de una variable aleatoria es compleja, pero pare efectos practicos tomaremos la siguiente difenicion:

* *Se define una variable aleatoria como el sistema compuesto por un rango de valores y su funcion de densidad.*

Esto quiere decir que, para una medida como el peso existen diferentes variables aleatorias. El grafico de las funciones de densidad del peso para hombres y mujeres asi lo demuestra, existe una variable aleatoria de peso para mujeres y otra de peso para los hombres. El peso de los colombianos no es el mismo peso de los norte americanos. Una variable aleatoria consiste en el conjunte de posibles valores que toma la variable junto con su funcion de densidad.

Ahora, para referirnos a una variable aleatoria usamos letras mayusculas. Por ejemplo, en el ejemplo del peso tenemos dos variables aleatorias diferentes: $W_F$ y $W_M$. para referirnos  a posibles valores arbitrarios que pueden tomar estas variables aleatorias usamos letras minusculas. Veamos un ejemplo:

$$P(W_F < x)$$

En esta expresion se traduce de la siguiente manera: La probabilidad de que la variable aleatoria peso de las mujeres ($W_F$) sea menor a un valor arbitrario ($x$).

Es fundamental la diferencia en los significados de los simbolos. Por ejemplo en el caso de las variables aleatorias discretas habiamos verificado que 

$$P(X=x)=f(x)$$

Es decir que la probabilidad de que la variable aleatoria $X$ tome un valor arbitrario $x$ es definida simplemente por su funcion de densidad $f(x)$.

# Parametros

En este punto, ya esta clara la representacion matematica que se emplea para expresar probabilidades en el caso de variables cuantitativas (bien sean discretas o continuas). La naturaleza de los conjuntos para los cuales se calculan probabilidades son segmentos de numeros (reales o enteros segun sea el caso). Y la forma de calcular las probabilidades es como areas bajo la funcion de densidad delimitados por los segmentos de numeros de interes. 

Es hora de hablar con mayor detalle acerca de las formulas matematicas que se usan como funciones densidad. Empesaremos estudiando la funcion de densidad del numero de hijos estudiada anteriormente. Reproducimos la grafica a continuacion, para facilidad de lectura (figura \@ref(fig:fdpoisr)).

```{r fdpoisr, echo=FALSE, results = 'asis',fig.width=7, fig.height=4, fig.cap="Funcion de densidad para la variable numero de hijos"}
dtf_pois<-data.frame(x=factor(0:11),y=dpois(0:11,3))
dtf_pois%>%ggplot(aes(x=x,y=y))+geom_point()+
  ylab("f(x)")+ theme_bw()+
  theme(axis.title.y = element_text(angle=0))+
  annotate("text", x = dtf_pois$x, y = dtf_pois$y+.01, 
           label = paste0("(",dtf_pois$x,", ",round(dtf_pois$y,3),")"),parse=F , size=2.5 , fontface="bold")
  
```

La formula de esta funcion de densidad es la siguiente:

\begin{equation}
f(x)=\frac{3^x e^{-3}}{x!} (\#eq:pois1)
\end{equation}

En esta formula, $x$ es un posible valor arbitrario que puede tomar la variable aleatoria $X$ (numero de hijos), $e$ es el numero de *oiler*, $x!$ se denomina *equis factorial*, esto se define como

$$n!=1\times 2 \times 3 ... \times n-1 \times n$$

Y aparece tambien el numero $3$. Usted puede verificar que efectivamente al evaluar diferentes valores de $x$ en la formula se obtienen los valores que aparecen en la figura \@ref(fig:fdpoisr).

## Funcion de densidad Poisson

El numero $3$ es lo que se conoce como un parametro y la formula general de la ecuacion \@ref(eq:pois1) se conoce como la funcion de densidad *Poisson* y es la siguiente:

\begin{equation}
f(x|\lambda)=\frac{\lambda^x e^{-\lambda}}{x!} (\#eq:poisg)
\end{equation}

Donde $f(x|\lambda)$ es una nueva notacion introducida, simplemente estamos definiendo que la funcion de densidad $f(x)$ depende de otra cantidad, $\lambda$ que se denomina parametro de la funcion de denisdad.

Veamos cual es elefecto del parametro $\lambda$ graficando diferentes funciones de densidad para diferentes valores de $\lambda$.
<center>
```{r , echo=F,warning =F, fig.width=6, fig.height=4}
gifdpois <- image_read("dpois.gif") 
gifdpois
```

```{r fdpoisr2, echo=FALSE, results = 'asis',fig.width=7, fig.height=4, fig.cap="Funcion de densidad para diferentes valores de <span>&lambda;</span>"}
xrange<-0:50
dtf_pois2<-data.frame(x=rep(xrange,5),
                      y=c(dpois(xrange,3),
                          dpois(xrange,7),
                          dpois(xrange,12),
                          dpois(xrange,19),
                          dpois(xrange,25)),
                      parameter=factor(rep(c(3,7,12,19,25), each = length(xrange)) ))

dtf_pois2%>%ggplot(aes(x=x,y=y,color=parameter))+geom_point()+
  theme_bw()+ labs(color = expression(lambda),
                                 y=expression(paste("f(x|",lambda,")")))
```
</center>

Observando la figura \@ref(fig:fdpoisr2), vemos que el valor de $\lambda$ afecta la forma de la funcion de densidad. Este es el concepto fundamental del parametro.

* Definicion: *un * **_Parametro_** *es una cantidad que controla la forma de una funcion de densidad*

¿Puede usted describir como el parametro $\lambda$ controla la forma de la funcion de denisdad *Poisson*?

Existe otro aspecto importante de esta funcion de densidad y es el conjunto de valores para la cual esta definida. Esta funcion de densidad se define para numeros enteros positivos. Por ejemplo no tiene sentido pensar en $1.5$ hijos en un hogar. 

## Funcion de densidad Normal

Vamos ahora a explorar la formula de la funcion de densidad normal, de la cual ya hemos visto un ejemplo, de hecho las formulas de las funciones de densidad para el peso de hombres y mujeres en el ejemplo tratado anteriormente pertenecen a esta clase.

La funcion de densidad normal se define mediante la siguiente ecuacion:

\begin{equation}
f(x|\mu, \sigma^{2})=\frac{1}{\sqrt{2\pi \sigma^2}}exp\left(\frac{-(x-\mu)^2}{\sigma^2}\right) (\#eq:dfnorm)
\end{equation}

en esta ecuacion hay dos parametros: $\mu$ y $\sigma^{2}$. A continuacion exploraremos la forma en que estos dos parametros contrlan la forma de la funcion de densidad.
<center>
```{r , echo=F,warning =F, fig.width=6, fig.height=4}
gifdnorm <- image_read("dnorm.gif") 
gifdnorm
```

```{r fdnorm1, echo=FALSE, results = 'asis',fig.width=8, fig.height=4, fig.cap="diferentes funciones de densidad normal"}
m1<-4
m2<-10

sd1<-3
sd2<-6
weight_lim<-c(-14, 27)
pdnorm1<-ggplot(data = data.frame(weight = weight_lim), aes(weight)) +
  stat_function(fun = dnorm, n = 101, args = list(mean = m1, sd = sd1),aes(color="black")) +
  stat_function(fun = dnorm, n = 101, args = list(mean = m2, sd = sd1),aes(color="red")) +
  stat_function(fun = dnorm, n = 101, args = list(mean = m1, sd = sd2),aes(color="blue")) +
  stat_function(fun = dnorm, n = 101, args = list(mean = m2, sd = sd2),aes(color="green")) +
  ylab(expression(paste("f(x|",mu,",",sigma^2,")"))) +xlab("x") + scale_x_continuous(breaks=seq(weight_lim[1],weight_lim[2], by =4)) + 
  scale_color_identity(name = "",
                          breaks = c("black", "red", "blue","green"),
                          labels = c(substitute(paste(mu,"= ", v," ,",sigma^2,"= ",s),list(v=m1,s=sd1)),
                                     substitute(paste(mu,"= ", v," ,",sigma^2,"= ",s),list(v=m2,s=sd1)), 
                                     substitute(paste(mu,"= ", v," ,",sigma^2,"= ",s),list(v=m1,s=sd2)),
                                     substitute(paste(mu,"= ", v," ,",sigma^2,"= ",s),list(v=m1,s=sd2))),
                          guide = "legend")+
  theme_bw()
pdnorm1
```
</center>
¿Puede usted describir como los parametros $\mu$ y $\sigma^2$ controlan la forma de la funcion de denisdad *Normal*?
Notese finalmente, cual es el conjunto de valores para los cuales la funcion de densidad normal esta definida: todos los numeros reales, tanto positivos como negativos.

## funcion de densidad gamma
Ahora estudiaremos una funcion de densidad que se encuentra exclusivamente definida para numeros reales positivos, la funcion de densidad gamma. Esta es su formula

$$f(x|\alpha,\beta)=\frac{1}{\beta^{\alpha}\Gamma(\alpha)}x^{\alpha-1}e^{-x/\beta}$$
De nuevo, $x$ son los valores que puede tomar la variable aleatoria, $\alpha, \; \beta$ son parametros, y $\Gamma()$ (letra griega mayuscula gamma) es una funcion matematica especial. Esta formula matematica se ve complicada, a continuacion presentamos algunas funciones de densidad para diferentes valores de $\alpha, \; \beta$

```{r fdgamma1, echo=FALSE, results = 'asis',fig.width=8, fig.height=4, fig.cap="diferentes funciones de densidad gamma"}
apar<-c(1,2,7.5,9)
bpar<-c(2,2,1.3,0.5)
gmaxlim<-c(0, 25)
pgma1<-ggplot(data = data.frame(x = gmaxlim), aes(gmaxlim)) +
  stat_function(fun = dgamma, n = 101, args = list(shape = apar[1], scale = bpar[1]),aes(color="black")) +
  stat_function(fun = dgamma, n = 101, args = list(shape = apar[2], scale = bpar[2]),aes(color="red")) +
  stat_function(fun = dgamma, n = 101, args = list(shape = apar[3], scale = bpar[3]),aes(color="blue")) +
  stat_function(fun = dgamma, n = 101, args = list(shape = apar[4], scale = bpar[4]),aes(color="green")) +
  ylab(expression(paste("f(x|",alpha,",",beta,")"))) +xlab("x") + scale_x_continuous(breaks=seq(gmaxlim[1],gmaxlim[2], by =5)) + 
  scale_color_identity(name = "",
                          breaks = c("black", "red", "blue","green"),
                          labels = c(substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[1],s=bpar[1])),
                                     substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[2],s=bpar[2])), 
                                     substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[3],s=bpar[3])),
                                     substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[4],s=bpar[4]))),
                          guide = "legend")+
  theme_bw()
pgma1
```
En este caso es mas dificil comprender cual es el efecto de $\alpha$ y $\beta$ en la forma de la funcion de densidad.

## funcion de densidad beta

Esta funcion de densidad es interesante porque esta definida para numeros reales exclusivamente entre $0$ y $1$. su formula es

$$f(x|\alpha,\beta)=\frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}x^{\alpha-1}(1-x)^{\beta-1}$$
veamos diferntes funciones de densidad para diferentes valores de $\alpha$ y $\beta$:

```{r fdbeta1, echo=FALSE, results = 'asis',fig.width=5.5, fig.height=4, fig.cap="diferentes funciones de densidad gamma"}
apar<-c(0.7,1,2.5,5)
bpar<-c(0.7,1,5,1)
btaxlim<-c(0, 1)
pbta1<-ggplot(data = data.frame(x = btaxlim), aes(btaxlim)) +
  stat_function(fun = dbeta, n = 101, args = list(shape1 = apar[1], shape2 = bpar[1]),aes(color="black")) +
  stat_function(fun = dbeta, n = 101, args = list(shape1 = apar[2], shape2 = bpar[2]),aes(color="red")) +
  stat_function(fun = dbeta, n = 101, args = list(shape1 = apar[3], shape2 = bpar[3]),aes(color="blue")) +
  stat_function(fun = dbeta, n = 101, args = list(shape1 = apar[4], shape2 = bpar[4]),aes(color="green")) +
  ylab(expression(paste("f(x|",alpha,",",beta,")"))) +xlab("x") + scale_x_continuous(breaks=seq(btaxlim[1],btaxlim[2], by =.1)) + 
  scale_color_identity(name = "",
                          breaks = c("black", "red", "blue","green"),
                          labels = c(substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[1],s=bpar[1])),
                                     substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[2],s=bpar[2])), 
                                     substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[3],s=bpar[3])),
                                     substitute(paste(alpha,"= ", v," ,",beta,"= ",s),list(v=apar[4],s=bpar[4]))),
                          guide = "legend")+
  theme_bw()
pbta1
```
Similar al caso de la funcion de densidad gamma, es dificil comprender cual es el efecto de $\alpha$ y $\beta$ en la forma de la funcion de densidad.

## Parametros de Localizacion y Dispercion

Del estudio del effecto que tienen los parametros en la funcion de densidad poisson y normal queda claro que existen dos aspecto prinicpales en la forma de una funcion de densidad. El primer aspecto es el de la localizacion, los parametros que contrlan la localizacion en las funciones de densidad poisson y normal son $\lambda$ y $\mu$ respectivamente. Estos parametros controlan en donde se ubica la zona mas "alta" de la funcion de densidad en el eje x (tecnicamente hablando controlan en donde se presenta el mayor valor de la funcion de densidad en relacion con el eje x). 

Por otra parte, vemos como el parametro $\sigma^2$ controla un aspecto geomtrico en particular en la funcion de densidad normal. Controla la forma en que la funcion se concentra o no al rededor del parametro de localizacion $\mu$. Valores grandes de $\sigma^2$ hacen que la curva se "aplane", mientras que valores pequeños de $\sigma^2$ hacen que la curva se "empine". Recuerdese que el area bajo la curva para uno u otra funcion de densidad es la misma ($1$), sugiriendo que estos cambios de aplanamiento o empinamiento hacen que la probabilidad se destribuya de manera diferente en uno u otro caso.

Para aclarar esto considere el siguiente ejemplo

```{r fdnormcompV,echo=FALSE, results = 'asis',fig.width=8, fig.height=4.5, fig.cap="Probabilidad de peso entre 50 y 90 para dos funciones de densidad diferentes"}
weight_lim<-c(10,130)
xrange<-c(mm-20,mm+20)
prb1<-round(pnorm(xrange[2],mm,sdm)-pnorm(xrange[1],mm,sdm),3)
prb2<-round(pnorm(xrange[2],mm,sdm+15)-pnorm(xrange[1],mm,sdm+15),3)
p11<-ggplot(data = data.frame(weight = weight_lim), aes(weight)) +
  stat_function(fun = dnorm, n = 101, args = list(mean = mm, sd = sdm),aes(color="black")) +
  stat_function(fun = dnorm, n = 101, args = list(mean = mm, sd = sdm+15),aes(color="red"))
  
p112<-p11+geom_segment(aes(x=xrange,xend=xrange,y=0,yend=.035),linetype=2)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm),
                xlim =xrange,
                geom = "area",fill="grey",alpha=0.5)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm+15),
                xlim =xrange,
                geom = "area",fill="red",alpha=0.5)+
  annotate("segment", x = c(mm), xend = c(100), 
           y = c(0.0275), yend = c(.03), colour = "grey", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("segment", x = c(mm), xend = c(40), 
           y = c(dnorm(mm,mm,sdm+15)/2), yend = c(.0175), colour = "red", size=1, alpha=0.6, arrow=arrow(length = unit(0.07, "npc")))+
  annotate("text", x = 100+7, y = .03, 
           label = prb1,parse=T , size=5 , fontface="bold")+
  annotate("text", x = 40-7, y = .0175, 
           label = prb2,parse=T , size=5 , fontface="bold")+
  scale_x_continuous(breaks=seq(weight_lim[1],weight_lim[2],by=10))+
  scale_color_identity(name = "",
                          breaks = c("black", "red"),
                          labels = c(substitute(paste(mu[M],"= ", v," ,",sigma[M]^2,"= ",s),list(v=mm,s=sdm^2)),
                                     substitute(paste(mu[F],"= ", v," ,",sigma[F]^2,"= ",s),list(v=mm,s=(sdm+15)^2))),
                          guide = "legend")+
  theme_bw()
p112
```
En la figura \@ref(fig:fdnormcompV) las dos funciones de densidad tienen el mismo valor del parametro $\mu$, sin embargo, la funcion de densidad roja ($f_F(w)$) tiene el parametro $\sigma_F^2= `r (sdm+15)^2`$ mientras la negra ($f_M(w)$) tiene $\sigma_M^2=`r (sdm)^2`$. Para la funcion de densidad roja se tiene que $P(50< W_F <90)= `r round(prb2,3)`$ mientras que para la negra, el mismo intervalo tiene probabilidad $P(50<W_M<90)= `r round(prb1,3)`$. En cual de las dos funciones de densidad hay mayor incertidumbre de observar valores entre $50$ y $90$? Claramente en la roja en donde $\sigma_F^2$ es mayor.

Consideremos ahora otro enfoque. El objetivo ahora sera el de encontrar un intervalo que concetre el $90%$ de probabilidad para las dos funciones de densidad $f_M(w)$ y $f_F(w)$.

```{r fdnormcompV2,echo=FALSE, results = 'asis',fig.width=8, fig.height=4.5, fig.cap="90% de probabilidad"}
qdf<-qnorm(c(.05,.95),mm,sdm+15)
qdm<-qnorm(c(.05,.95),mm,sdm)

p113<-p11+geom_segment(aes(x=qdf,xend=qdf,y=0,yend=dnorm(qdf,mm,sdm+15)),linetype=2,col="red")+
  geom_segment(aes(x=qdm,xend=qdm,y=0,yend=dnorm(qdm,mm,sdm)),linetype=2,col="black")+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm),
                xlim =qdm,
                geom = "area",fill="grey",alpha=0.7)+
  stat_function(fun = dnorm, args = list(mean = mm,sd=sdm+15),
                xlim =qdf,
                geom = "area",fill="red",alpha=0.3)+
  scale_x_continuous(breaks=c(qdf[1],qdm[1],qdf[2],qdm[2])%>%round(3))+
  scale_color_identity(name = "",
                          breaks = c("black", "red"),
                          labels = c(substitute(paste(mu[M],"= ", v," ,",sigma[M]^2,"= ",s),list(v=mm,s=sdm^2)),
                                     substitute(paste(mu[F],"= ", v," ,",sigma[F]^2,"= ",s),list(v=mm,s=(sdm+15)^2))),
                          guide = "legend")+
  theme_bw()
p113
```

En la figura \@ref(fig:fdnormcompV2) se presentan los rangos correspondientes para cada funcion de densidad. Ambas areas acumulan la misma probabilidad (90%). Sin embargo es claro que esta probabilidad se acumula en un rango mucho mas ampli en la funcion de densidad $f_F(w)$, en comparacion a $f_M(w)$. Decimos entonces, que hay mayor "dispercion" en $f_F(w)$ en comparacion con $f_M(w)$. Esta "dispercion" hace referencia a que los posibles valores que podemos observar para la variable $W_f$ son mucho mas disperos, o tienen un rango de variacion mayor en comparacion con la variable $W_M$.

En conclucion, hemos presentado como se ve el efecto de parametros de localizacion y dispersion. Puede usted notar que el parametro $\lambda$ en la funcion de densidad poisson es, ademas de ser un parametro de localizacion, tambien un parametro de dispercion? (ver figura \@ref(fig:fdpoisr2))

# Parametros generales

Como vimos en la seccion anterior, dependiendo de la formula de la funcion de densidad pueden existir uno o dos parametros y su efecto en la forma de la funcion de densidad tambien depende de la formula matematica en cada caso. Sin embargo existen otro tipo de parametros que, en algunos casos, no se encuentran de manera explicita en estas formulas. Estos parametros, sin embargo, son calculados usando la funcion matematica que describe la funcion de densidad. Los parametros que estudiaremos a continuacion son **El Valor esperado, La Moda, La Mediana, La Varianza** y **La Desviacion Estandar**.

## Valor Esperado

El valor esperado de una variable aleatoria $X$ se define como

\begin{equation}
Valor \; Esperado \; de \; X=E(X)=\sum_{i=1}^{n}f(x_i)\times x_i (\#eq:EVdis)
\end{equation}
En el caso de una variable aleatoria discreta y 

\begin{equation}
Valor \; Esperado \; de \; X=E(X)=\int_{-\infty}^{\infty}f(x)dx (\#eq:EVcont)
\end{equation}

En el caso de una variable aleatoria continua. Estas forumulas parecen complicadas, empezaremos nuestra exploracion de este parametro en el caso de una variable aleatoria discreta.
Recurdese que en el caso de una variable discreta $f(x_i)=P(X=x_i)$, luego la ecuacion \@ref(eq:EVdis) se puede reescribir como

$$E(X)=\sum_{i=1}^{n}f(x_i)\times x_i=$$
$$\sum_{i=1}^{n}P(X=x_i) \times x_i$$

Es decir que el valor esperado para una variable discreta consiste en la suma ponderada de todos sus posibles valores multiplicados por su probabilidad. Calculemos el valor esperado paraa la variable numero de hijos. Reproducimos la grafica a continuacion, para facilidad de lectura (figura \@ref(fig:fdpoisrr2)).

```{r fdpoisrr2, echo=FALSE, results = 'asis',fig.width=7, fig.height=4, fig.cap="Funcion de densidad para la variable numero de hijos"}
dtf_pois<-data.frame(x=factor(0:11),y=dpois(0:11,3))
dtf_pois%>%ggplot(aes(x=x,y=y))+geom_point()+
  ylab("f(x)")+ theme_bw()+
  theme(axis.title.y = element_text(angle=0))+
  annotate("text", x = dtf_pois$x, y = dtf_pois$y+.01, 
           label = paste0("(",dtf_pois$x,", ",round(dtf_pois$y,3),")"),parse=F , size=2.5 , fontface="bold")
```

Segun la formula \@ref(eq:EVdis) el calculo del valor esperado es el siguiente:

$$E(X)=\sum_{i=1}^{n}f(x_i)\times x_i=$$
$$E(X)=f(0)\times 0+f(1)\times 1+f(2)\times 2+ ... +f(11)\times 11=$$
$$`r dtf_pois$x[1]` \times `r round(dtf_pois$y[1],3)`+`r dtf_pois$x[2]` \times `r round(dtf_pois$y[2],3)`+`r dtf_pois$x[3]` \times `r round(dtf_pois$y[3],3)`+...+`r dtf_pois$x[12]` \times `r round(dtf_pois$y[12],3)`=$$
$$`r sum((0:11)*dtf_pois$y)` \approx 3$$